{% extends 'educalims/base.html' %}

{% block title %}{{ fichier.nom }} - Educalims{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb" class="mt-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'educalims:home' %}"><i class="bi bi-house-door"></i> Accueil</a></li>
        <li class="breadcrumb-item"><a href="{% url 'educalims:disciplines_list' %}"><i class="bi bi-grid"></i> Disciplines</a></li>
        <li class="breadcrumb-item">
            <a href="{% url 'educalims:niveau_detail' fichier.unite.niveau.pk %}">
                <i class="bi bi-layers"></i> {{ fichier.unite.niveau.nom }}
            </a>
        </li>
        <li class="breadcrumb-item">
            <a href="{% url 'educalims:unite_detail' fichier.unite.pk %}">
                <i class="bi bi-folder"></i> {{ fichier.unite.nom }}
            </a>
        </li>
        <li class="breadcrumb-item active"><i class="bi bi-file-earmark"></i> {{ fichier.nom }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
                {% if fichier.type_fichier == 'PDF' %}
                <i class="bi bi-file-pdf-fill text-danger"></i>
                {% elif fichier.type_fichier == 'VID' %}
                <i class="bi bi-file-play-fill text-primary"></i>
                {% elif fichier.type_fichier == 'TXT' %}
                <i class="bi bi-file-text-fill text-info"></i>
                {% elif fichier.type_fichier == 'LNK' %}
                <i class="bi bi-link-45deg text-success"></i>
                {% elif fichier.type_fichier == 'IMG' %}
                <i class="bi bi-file-image-fill text-warning"></i>
                {% else %}
                <i class="bi bi-file-earmark"></i>
                {% endif %}
                {{ fichier.nom }}
            </h3>
            <span class="badge badge-gabon-green">{{ fichier.get_type_fichier_display }}</span>
        </div>
    </div>
    {% if fichier.description %}
    <div class="card-body">
        <p class="mb-0 text-light">{{ fichier.description }}</p>
    </div>
    {% endif %}
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-eye"></i> Aperçu du contenu</h5>
            </div>
            <div class="card-body">
                {% if fichier.type_fichier == 'LNK' and fichier.url_lien %}
                <div class="alert alert-info">
                    <i class="bi bi-link-45deg"></i> Ce fichier est un lien externe.
                    <a href="{{ fichier.url_lien }}" target="_blank" class="btn btn-gabon ms-2">
                        Ouvrir le lien <i class="bi bi-box-arrow-up-right"></i>
                    </a>
                </div>
                {% elif fichier.fichier %}
                <div class="text-center">
                    <p class="mb-3 text-light">
                        <i class="bi bi-file-earmark" style="font-size: 4rem;"></i>
                    </p>
                    <a href="{{ fichier.fichier.url }}" target="_blank" class="btn btn-gabon btn-lg">
                        <i class="bi bi-download"></i> Télécharger le fichier
                    </a>
                </div>
                {% elif fichier.contenu_texte %}
                <div class="bg-dark p-3 rounded" style="max-height: 400px; overflow-y: auto;">
                    <pre class="text-light mb-0" style="white-space: pre-wrap;">{{ fichier.contenu_texte }}</pre>
                </div>
                {% else %}
                <p class="text-center text-light">Aucun contenu disponible.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Informations</h5>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong><i class="bi bi-folder"></i> Unité:</strong><br>
                <a href="{% url 'educalims:unite_detail' fichier.unite.pk %}">{{ fichier.unite.nom }}</a></p>
                <p class="mb-2"><strong><i class="bi bi-book"></i> Discipline:</strong><br>
                {{ fichier.unite.discipline.nom }}</p>
                <p class="mb-2"><strong><i class="bi bi-layers"></i> Niveau:</strong><br>
                {{ fichier.unite.niveau.nom }}</p>
                {% if fichier.duree %}
                <p class="mb-2"><strong><i class="bi bi-clock"></i> Durée:</strong><br>
                {{ fichier.duree }} secondes</p>
                {% endif %}
                {% if fichier.taille %}
                <p class="mb-2"><strong><i class="bi bi-hdd"></i> Taille:</strong><br>
                {{ fichier.taille }} octets</p>
                {% endif %}
                <p class="mb-0"><strong><i class="bi bi-calendar"></i> Ajouté le:</strong><br>
                {{ fichier.date_creation|date:"d/m/Y H:i" }}</p>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-graph-up"></i> Statistiques</h5>
            </div>
            <div class="card-body">
                <p class="mb-0">
                    <i class="bi bi-download"></i>
                    <strong>{{ fichier.telechargements }}</strong> téléchargement{{ fichier.telechargements|pluralize }}
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
